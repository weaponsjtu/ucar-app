<!DOCTYPE html> 
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta charset="utf-8">
<title>账号设置</title>
<link href="jquery-mobile/jquery.mobile-1.2.0-alpha.1.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.7.2.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.2.0-alpha.1.js" type="text/javascript"></script>
<script src="cordova.js" type="text/javascript"></script>
<style type="text/css">
#main {
	background:url("img/back.jpg") repeat;
}

#account {
	border-radius: 15px;
	border-style: solid;
	border-color: white;
	border-width: 1px;
	background-color: white;
	margin: 0 10px;
}

.center {
	text-align:center;
}
</style>

</head>

<body>

<div id="main" data-role="page">
 <div data-role="header"  data-theme="b">
   <a href="#" onClick="backindex()" class="ui-btn-back">主页</a>
   <h1><a href="#" data-role="button">账号设置</a></h1>
 </div>

 
 <div data-role="content">
   <h1>快速登录</h1>
   <div id="user"></div>
   
   <p style="text-align: right;">您可以随时关闭与合作平台的分享设置</p>
   
   <p class="center">点击阅读隐私声明</p>
   <p class="center">如您选择登录即视为同意并愿意遵守原则</p>
 </div>
 
  <div data-role="footer">
   <h3>当前位置:<b id="current"></b></h3>
 </div>
 
</div>

<script type="text/javascript">
var url=window.location.href;
var arg1=url.split("=");
var arg2=arg1[1].split("&");
var img=arg2[0];
arg3=arg1[2].split("&");
var name=decodeURI(arg3[0]);
var arg4=arg1[3].split("&");
var accesstoken=arg4[0];
var uid=arg1[4];

/*$.ajaxSettings.async = false;
$.getJSON('https://api.weibo.com/2/users/show.json?callback=?', 
  {access_token:accesstoken, uid:sinaid},
  function(json){
	//console.info(json);
	nickname=json.data.screen_name;
	image=json.data.profile_image_url;
	$.ajax({type:'POST',async:false, url:'http://ihavecar.sinaapp.com/postuser.php?nickname='+nickname+'&photo='+image});
	var html='<table>';
	html+='<tr><td><img src="'+image+'" width="60" height="60"></td>';
	html+='<td>'+nickname+'  </td>';
	html+='</tr></table>';
	$('#user').html(html);
}
);*/
writefile();
var html='<table>';
	html+='<tr><td><img src='+img+' width="60" height="60"></td>';
	html+='<td>'+name+' </td>';
	html+='</tr></table>';
	$('#user').html(html);
	
function sinalogin(){
	window.location.href ='https://api.weibo.com/oauth2/authorize?client_id=3943049038&redirect_uri=http://ihavecar.sinaapp.com/logined.html&response_type=token';
}
function qqlogin(){
	window.location.href ='https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=100284268&redirect_uri=http://ihavecar.sinaapp.com/qqsuccess.html';
}
function writefile(){
	//等待加载PhoneGap

	document.addEventListener("deviceready", onDeviceReady, false);

	// PhoneGap加载完毕

	function onDeviceReady() {
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	}
         //获取newFile目录，如果不存在则创建该目录
	function gotFS(fileSystem) {
		newFile = fileSystem.root.getDirectory("ucar", {create : true,exclusive : false}, writerFile, fail);		
	}
	//获取newFile目录下面的dataFile.txt文件，如果不存在则创建此文件
	function writerFile(newFile) {
		newFile.getFile("DataFile.txt", {create : true,exclusive : false}, gotFileEntry, fail);
	}
	
	function gotFileEntry(fileEntry) {
		fileEntry.createWriter(gotFileWriter, fail);
	}

	function gotFileWriter(writer) {
		writer.onwrite = function(evt) {
			//alert("write success");
		};
		writer.write("uid="+uid+";accesstoken="+accesstoken+";name="+name+";img="+img+";");
	}

	function fail(error) {
		alert("Failed to retrieve file:" + error.code);
	}
	// 检索一个已存在的文件，如果该文件不存在时则创建该文件
}

function backindex(){
	//qq登录v1暂时不做
	window.location.href ='index.html';
}
</script>
</body>
</html>