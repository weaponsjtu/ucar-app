<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>分享页面</title>
<link href="jquery-mobile/jquery.mobile-1.2.0-alpha.1.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.7.2.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.2.0-alpha.1.js" type="text/javascript"></script>
<script src="cordova.js" type="text/javascript"></script>
<script type="text/javascript" src="http://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js" data-appid="100284268" data-redirecturi="http://ihavecar.sinaapp.com/qc_callback.html" charset="utf-8"></script>
<script type="text/javascript" src="jquery.raty.js"></script>

<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.3"></script>
<script type="text/javascript" src="http://dev.baidu.com/wiki/static/map/API/examples/script/convertor.js"></script>
<script type="text/javascript" src="UcarV1.js"></script>

<script type="text/javascript">
$(function() {
	$('#star').raty({
		size:      24,
		starHalf:  'star-half-big.png',
		starOff:   'star-off-big.png',
		starOn:    'star-on-big.png'
	});
});

function back(){
	if (typeof(navigator) != 'undefined' && typeof(navigator.app) != 'undefined' && typeof(navigator.app.backHistory) == 'function') {
		navigator.app.backHistory();
	} else{
		history.back();
	}
}

$(document).ready(function(){
	$("#content").css("min-height", document.body.clientHeight - $("#content").offset().top - $("#footer").height());
	
	getGPS();
	jQuery('body').live('swipeleft',function(event){
		back();
		//event.preventDefault();
	});
	jQuery('body').live('swiperight',function(event){
		window.history.forward();
		//event.preventDefault();
	});
});

$('.ui-btn-back').live('tap',function() {
	back();
	return false;
}).live('click',function() {
	back();
	return false;
});
</script>

<style type="text/css">
#sina {
	background: url('img/ucar_icon.gif') 0 0 no-repeat;
	width: 16px;
	height: 16px;
}

</style>

</head>

<body>

<div data-role="page">

 <div data-role="header" data-theme="b">
   <a href="#" class="ui-btn-back">返回</a>
   <h1>点评与分享</h1>
   <a input id="submit" onClick="share()">发送</a>
 </div>
 
 <div data-role="content" id="content">
 <form action="" method="post">	
 	<div style="text-align: center" >
 		 <span  style="border-bottom: solid gray 1px" id="star"></span>
 	</div>
    
  <label for="textarea-a">发表评论: <span style="float:right;">140字</span></label>
	<textarea name="textarea" id="textarea-a" autofocus></textarea>
    
  <div><span style="float:right;">我要分享到&nbsp;&nbsp;<img id="sina"></img></span></div>
 </form>
 </div>
 
 <div data-role="footer" id="footer">
   <h4>当前位置:&nbsp;&nbsp;<b id="current"></b></h4>
 </div>

<script type="text/javascript">
var star=new Array("★","★★","★★★","★★★★","★★★★★");
var access_token="2.00zf_UtBILdqSE009e65d2e9d_jVUB";
var shopname="西北偏北";
var uid="1736056791";
function share(){
	//readfile();
	var score = $('#star').raty('score');
	var con = document.getElementsByName('textarea');
	$.ajax({type:'POST', url:'https://api.weibo.com/2/statuses/update.json',data:{access_token:access_token,uid:uid,client_id:"3943049038",status:"我在"+shopname+"，"+con[0].value+" ，评分："+star[score-1],lat:31.176173,long:121.127916}});
	/*var check = document.getElementsByName('CheckboxGroup');	
	for(i=0;i<check.length;i++){
		if(check[i].checked){
			if(check[i].id=="QQ_share"){
				$.ajax({type:'POST',async:false, url:'https://graph.qq.com/t/add_t',data:{access_token:"40E4FBB667C41EBD4656236CB917EFC4",oauth_consumer_key:"100284268",openid:"D08D45C9F3E2F67A5B96EA312FFF61D8",content:"我正在某某地干嘛"+con[0].value+"  "+star[score-1]}});
			}
			if(check[i].id=="sina_share"){
				$.ajax({type:'POST',async:false, url:'https://api.weibo.com/2/statuses/update.json',data:{access_token:"2.00zf_UtBILdqSE750dcc0906gRNEaE",uid:"1736056791",client_id:"3943049038",status:"我在这里xxxx，我觉得"+con[0].value+" ，我打"+star[score-1],lat:31.176173,long:121.127916}});
			}
		}
	}*/
	$.ajax({type:'POST',async:false, url:'http://ihavecar.sinaapp.com/postcomment.php?shopid=1&userid='+uid+'&score='+score+'&content="'+con[0].value+'"'});

	window.location.href ='shopinfo.html';
}

function readfile() {
	document.addEventListener("deviceready", onDeviceReady, false);
    // PhoneGap is ready
    function onDeviceReady() {
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
    }

    function gotFS(fileSystem) {
        fileSystem.root.getFile("ucar/DataFile.txt", {create: true}, gotFileEntry, fail);
    }

    function gotFileEntry(fileEntry) {
        fileEntry.file(gotFile, fail);
    }

    function gotFile(file){
        readAsText(file);
    }

    function readAsText(file) {
				//alert("hello");
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            //console.log("Read as text");
            //console.log(evt.target.result);
			var arg=evt.target.result.split(";");
			for(i=0;i<3;i++){
				var arg1=arg[i].split("=");
				if(arg1[0]=="sina_accesstoken"){
					sina_accesstoken=arg1[1];
				}
				if(arg1[0]=="sina_openid"){
					sina_openid=arg1[1];
				}
			}
        };
        reader.readAsText(file);
    }

    function fail(evt) {
        console.log(evt.target.error.code);
    }
}

</script>
</body>
</html>