<!DOCTYPE html> 
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta charset="utf-8">
<title>账号设置</title>
<link href="jquery-mobile/jquery.mobile-1.2.0-alpha.1.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.7.2.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.2.0-alpha.1.js" type="text/javascript"></script>
<script src="cordova.js" type="text/javascript"></script>
<script type="text/javascript">
function back(){
	if (typeof(navigator) != 'undefined' && typeof(navigator.app) != 'undefined' && typeof(navigator.app.backHistory) == 'function') {
		navigator.app.backHistory();
	} else{
		history.back();
	}
}

$(document).ready(function(){
	jQuery('body').live('swipeleft',function(event){
		back();
		//event.preventDefault();
	});
	jQuery('body').live('swiperight',function(event){
		window.history.forward();
		//event.preventDefault();
	});
	
	$("#sinaframe").css('width', document.body.clientWidth);
	$("#sinaframe").css('height', document.body.clientHeight - $("#sinaframe").offset().top);
});

$('.ui-btn-back').live('tap',function() {
	back();
	return false;
}).live('click',function() {
	back();
	return false;
});


</script>

</head>
<body>
<div data-role="page">
	 <div data-role="header"  data-theme="b">
    <a href="#" class="ui-btn-back">返回</a>
    <h1><a href="#" data-role="button">新浪授权</a></h1>
   </div>
   <div date-role="content">
     <iframe id="sinaframe"
	     src="https://api.weibo.com/oauth2/authorize?client_id=3943049038&redirect_uri=http://ihavecar.sinaapp.com/callback.php&response_type=code">
     </iframe>
   </div>
</div>

<script type="text/javascript">
// iframe内的数据与本地phonegap数据跨域通讯
window.onmessage=function(e){
	var json_str = e.data;
	var access_token = json_str.access_token;
	var uid = json_str.uid;
	var image = json_str.image;
	var nickname = json_str.name;
	$.ajax({type:'POST',async:false, url:'http://ihavecar.sinaapp.com/postuser.php?nickname='+nickname+'&photo='+image+'&sina='+uid+'&uid='+uid+'&qq=0'});
	
//加密传输	
	window.location.href =encodeURI('logined.html?img='+image+'&name='+nickname+'&accesstoken='+access_token+'&uid='+uid);
};	
	//window.location.href =encodeURI('logined.html?img='+image+'&name='+nickname);

	
</script>
</body>
</html>