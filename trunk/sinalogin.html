<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>账号设置</title>
<link href="jquery-mobile/jquery.mobile-1.2.0-alpha.1.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.7.2.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.2.0-alpha.1.js" type="text/javascript"></script>
<script src="cordova.js" type="text/javascript"></script>
<script type="text/javascript">
function back(){
	if (typeof(navigator) != 'undefined' && typeof(navigator.app) != 'undefined' && typeof(navigator.app.backHistory) == 'function') {
		navigator.app.backHistory();
	} else{
		history.back();
	}
}

$(document).ready(function(){
	jQuery('body').live('swipeleft',function(event){
		back();
		//event.preventDefault();
	});
	jQuery('body').live('swiperight',function(event){
		window.history.forward();
		//event.preventDefault();
	});
});

$('.ui-btn-back').live('tap',function() {
	back();
	return false;
}).live('click',function() {
	back();
	return false;
});

</script>

</head>
<body>
<div data-role="page">
	 <div data-role="header"  data-theme="b">
    <a href="#" class="ui-btn-back">返回</a>
    <h1>新浪微博</h1>
   </div>
   <div date-role="content">
     <iframe id="sinaframe"  Height="400px" border=0 frameBorder=0 Width="700px" scrolling=no 
	     src="https://api.weibo.com/oauth2/authorize?client_id=3943049038&redirect_uri=http://ihavecar.sinaapp.com/callback.php&response_type=code">
     </iframe>
   </div>
</div>

<script type="text/javascript">
window.onmessage=function(e) {
/*	var json_str = e.data;
	var json_data = JSON.parse(json_str);
	var access_token = json_data.access_token;
	var data = json_data.data;*/
	function writefile(){
	//等待加载PhoneGap

	document.addEventListener("deviceready", onDeviceReady, false);

	// PhoneGap加载完毕

	function onDeviceReady() {
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	}
         //获取newFile目录，如果不存在则创建该目录
	function gotFS(fileSystem) {
		newFile = fileSystem.root.getDirectory("UCAR", {create : true,exclusive : false}, writerFile, fail);		
	}
	//获取newFile目录下面的dataFile.txt文件，如果不存在则创建此文件
	function writerFile(newFile) {
		newFile.getFile("dataFile.txt", {create : true,exclusive : false}, gotFileEntry, fail);
	}
	
	function gotFileEntry(fileEntry) {
		fileEntry.createWriter(gotFileWriter, fail);
	}

	function gotFileWriter(writer) {
		writer.onwrite = function(evt) {
			alert("write success");
		};
		writer.write("access_token:"+e.data);
	}

	function fail(error) {
		alert("Failed to retrieve file:" + error.code);
	}
	// 检索一个已存在的文件，如果该文件不存在时则创建该文件
}
	window.location.href ='logined.html?img='+e.data;
};
	
</script>
</body>
</html>